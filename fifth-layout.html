<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>è¨­è¨ˆ - ã‚ã¾ã‚Šã«ã‚‚è¶…å¤§é‡ã®é€£çµãƒªã‚¹ãƒˆã§å­¦ã¶Rust</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Learning Rust With Entirely Too Many Linked Lists">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="index.html"><strong aria-hidden="true">1.</strong> ã¯ã˜ã‚ã«</a></li><li><a href="first.html"><strong aria-hidden="true">2.</strong> ã‚¯ã‚½ã‚¹ã‚¿ãƒƒã‚¯</a></li><li><ol class="section"><li><a href="first-layout.html"><strong aria-hidden="true">2.1.</strong> è¨­è¨ˆ</a></li><li><a href="first-new.html"><strong aria-hidden="true">2.2.</strong> New</a></li><li><a href="first-ownership.html"><strong aria-hidden="true">2.3.</strong> æ‰€æœ‰æ¨©</a></li><li><a href="first-push.html"><strong aria-hidden="true">2.4.</strong> Push</a></li><li><a href="first-pop.html"><strong aria-hidden="true">2.5.</strong> Pop</a></li><li><a href="first-test.html"><strong aria-hidden="true">2.6.</strong> ãƒ†ã‚¹ãƒˆ</a></li><li><a href="first-drop.html"><strong aria-hidden="true">2.7.</strong> Drop</a></li><li><a href="first-final.html"><strong aria-hidden="true">2.8.</strong> æœ€çµ‚ã‚³ãƒ¼ãƒ‰</a></li></ol></li><li><a href="second.html"><strong aria-hidden="true">3.</strong> ã¾ã‚ã¾ã‚ãªã‚¹ã‚¿ãƒƒã‚¯</a></li><li><ol class="section"><li><a href="second-option.html"><strong aria-hidden="true">3.1.</strong> Option</a></li><li><a href="second-generic.html"><strong aria-hidden="true">3.2.</strong> ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹</a></li><li><a href="second-peek.html"><strong aria-hidden="true">3.3.</strong> Peek</a></li><li><a href="second-into-iter.html"><strong aria-hidden="true">3.4.</strong> IntoIter</a></li><li><a href="second-iter.html"><strong aria-hidden="true">3.5.</strong> Iter</a></li><li><a href="second-iter-mut.html"><strong aria-hidden="true">3.6.</strong> IterMut</a></li><li><a href="second-final.html"><strong aria-hidden="true">3.7.</strong> æœ€çµ‚ã‚³ãƒ¼ãƒ‰</a></li></ol></li><li><a href="third.html"><strong aria-hidden="true">4.</strong> æ°¸ç¶šã‚¹ã‚¿ãƒƒã‚¯</a></li><li><ol class="section"><li><a href="third-layout.html"><strong aria-hidden="true">4.1.</strong> è¨­è¨ˆ</a></li><li><a href="third-basics.html"><strong aria-hidden="true">4.2.</strong> åŸºæœ¬</a></li><li><a href="third-drop.html"><strong aria-hidden="true">4.3.</strong> Drop</a></li><li><a href="third-arc.html"><strong aria-hidden="true">4.4.</strong> Arc</a></li><li><a href="third-final.html"><strong aria-hidden="true">4.5.</strong> æœ€çµ‚ã‚³ãƒ¼ãƒ‰</a></li></ol></li><li><a href="fourth.html"><strong aria-hidden="true">5.</strong> ãƒ¡ãƒ¢ãƒªå®‰å…¨ã‚¯ã‚½ä¸¡ç«¯ã‚­ãƒ¥ãƒ¼</a></li><li><ol class="section"><li><a href="fourth-layout.html"><strong aria-hidden="true">5.1.</strong> è¨­è¨ˆ</a></li><li><a href="fourth-building.html"><strong aria-hidden="true">5.2.</strong> ä½œã‚‹</a></li><li><a href="fourth-breaking.html"><strong aria-hidden="true">5.3.</strong> å´©ã™</a></li><li><a href="fourth-peek.html"><strong aria-hidden="true">5.4.</strong> Peek</a></li><li><a href="fourth-symmetry.html"><strong aria-hidden="true">5.5.</strong> å¯¾ç§°çš„ãªæ“ä½œã®å®Ÿè£…</a></li><li><a href="fourth-iteration.html"><strong aria-hidden="true">5.6.</strong> ã‚¤ãƒ†ãƒ¬ãƒ¼ãƒˆ</a></li><li><a href="fourth-final.html"><strong aria-hidden="true">5.7.</strong> æœ€çµ‚ã‚³ãƒ¼ãƒ‰</a></li></ol></li><li><a href="fifth.html"><strong aria-hidden="true">6.</strong> ãƒ¡ãƒ¢ãƒªä¸å®‰å…¨ã‚­ãƒ¥ãƒ¼</a></li><li><ol class="section"><li><a href="fifth-layout.html" class="active"><strong aria-hidden="true">6.1.</strong> è¨­è¨ˆ</a></li><li><a href="fifth-unsafe.html"><strong aria-hidden="true">6.2.</strong> Unsafe</a></li><li><a href="fifth-basics.html"><strong aria-hidden="true">6.3.</strong> åŸºæœ¬</a></li><li><a href="fifth-extras.html"><strong aria-hidden="true">6.4.</strong> å¿œç”¨</a></li><li><a href="fifth-final.html"><strong aria-hidden="true">6.5.</strong> æœ€çµ‚ã‚³ãƒ¼ãƒ‰</a></li></ol></li><li><a href="sixth.html"><strong aria-hidden="true">7.</strong> ã¾ã‚ã¾ã‚ãªãƒ¡ãƒ¢ãƒªä¸å®‰å…¨ä¸¡ç«¯ã‚­ãƒ¥ãƒ¼</a></li><li><a href="infinity.html"><strong aria-hidden="true">8.</strong> ã‚¢ãƒ›ãªãƒªã‚¹ãƒˆãŸã¡</a></li><li><ol class="section"><li><a href="infinity-double-single.html"><strong aria-hidden="true">8.1.</strong> äºŒé‡ç‰‡æ–¹å‘ãƒªã‚¹ãƒˆ</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">ã‚ã¾ã‚Šã«ã‚‚è¶…å¤§é‡ã®é€£çµãƒªã‚¹ãƒˆã§å­¦ã¶Rust</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#è¨­è¨ˆ" id="è¨­è¨ˆ">è¨­è¨ˆ</a></h1>
<p>ã§ï¼Œç‰‡æ–¹å‘ã‚­ãƒ¥ãƒ¼ã¨ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿç‰‡æ–¹å‘ã‚¹ã‚¿ãƒƒã‚¯ã®ã¨ãï¼Œç§é”ã¯ãƒªã‚¹ãƒˆã®æœ€å¾Œã«pushã—ã¦
åŒã˜æ–¹å‘ã‹ã‚‰popã—ã¾ã—ãŸï¼ã‚­ãƒ¥ãƒ¼ã¨ã‚¹ã‚¿ãƒƒã‚¯ã®é•ã„ã¯popã™ã‚‹ã®ãŒé€†å´ã‹ã‚‰ã§ã‚ã‚‹ã“ã¨ã ã‘ã§ã™ï¼
ã‚¹ã‚¿ãƒƒã‚¯ã®ã¨ãã¯ã“ã‚“ãªæ„Ÿã˜ã§ã—ãŸï¼š</p>
<pre><code class="language-text">input list:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)

stack push X:
[Some(ptr)] -&gt; (X, Some(ptr)) -&gt; (A, Some(ptr)) -&gt; (B, None)

stack pop:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)
</code></pre>
<p>ã‚­ãƒ¥ãƒ¼ã‚’ä½œã‚‹ã«ã¯ï¼Œpopã¨pushã®ã©ã¡ã‚‰ã§ãƒªã‚¹ãƒˆã®æœ€å¾Œã®è¦ç´ ã‚’æ“ä½œã™ã‚‹ã‹æ±ºã‚ãªãã¦ã¯
ã„ã‘ã¾ã›ã‚“ï¼ç‰‡æ–¹å‘ãƒªã‚¹ãƒˆãªã®ã§ã©ã£ã¡ã«ã—ã‚åŒç¨‹åº¦ã®è¨ˆç®—é‡ã«ãªã‚Šã¾ã™ï¼</p>
<p><code>push</code>ã‚’æœ€å¾Œã«ã™ã‚‹ãªã‚‰ï¼Œãƒªã‚¹ãƒˆã‚’<code>None</code>ãŒå‡ºã‚‹ã¾ã§ãŸã©ã‚Šæ–°ã—ã„è¦ç´ ãŒå…¥ã£ãŸSomeã«
å…¥ã‚Œæ›¿ãˆã¾ã™ï¼</p>
<pre><code class="language-text">input list:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)

flipped push X:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, Some(ptr)) -&gt; (X, None)
</code></pre>
<p><code>pop</code>ã‚’æœ€å¾Œã«ã™ã‚‹ãªã‚‰ï¼Œãƒªã‚¹ãƒˆã‚’<code>None</code>ãŒå‡ºã‚‹<em>ç›´å‰ã¾ã§</em>ãŸã©ã‚Š<code>take</code>ã—ã¾ã™ï¼</p>
<pre><code class="language-text">input list:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, Some(ptr)) -&gt; (X, None)

flipped pop:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)
</code></pre>
<p>ã“ã‚Œã®ã©ã¡ã‚‰ã‹ã‚’ã‚„ã£ã¦å®Œæˆã§ã‚‚ã„ã„ã§ã™ãŒï¼Œã“ã‚Œã§ã¯ãŠç²—æœ«ã§ã™ï¼ã©ã¡ã‚‰ã«ã›ã‚ˆãƒªã‚¹ãƒˆã®
<em>å…¨ä½“</em>ã‚’ãŸã©ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼æ­£ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã®ã§ã‚­ãƒ¥ãƒ¼ã®å®Ÿè£…ã¨ã—ã¦ã¯
ã“ã‚Œã§ã„ã„ã¨ã„ã†äººã‚‚ã„ã‚‹ã§ã—ã‚‡ã†ï¼ã§ã™ãŒç§ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ä¿è¨¼ã™ã‚‹ã“ã¨ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®
ä¸€éƒ¨ã§ã‚ã‚‹ã¨è€ƒãˆã¾ã™ï¼æ¼¸è¿‘çš„å¢ƒç•ŒãŒã©ã†ã®ã¨ã„ã†è©±ã§ã¯ãªã<em>é€Ÿã„</em>ã‹<em>é…ã„</em>ã‹ã§ã™ï¼ã‚­ãƒ¥ãƒ¼ã¯
popã¨pushãŒé€Ÿã„ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã‚ã‚Šï¼Œãƒªã‚¹ãƒˆå…¨ä½“ã‚’ãŸã©ã‚‹æ“ä½œã¯æ˜ã‚‰ã‹ã«é€Ÿãã¯
ã‚ã‚Šã¾ã›ã‚“ï¼</p>
<p>ã²ã¨ã¤ã®é‡è¦ãªè¦–ç‚¹ã¯ï¼ŒåŒã˜ã“ã¨ã‚’ä½•å›ã‚‚ç¹°ã‚Šè¿”ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ç„¡é§„ã«ã—ã¦ã„ã‚‹ã“ã¨ã§ã™ï¼
ã“ã®æ“ä½œã‚’è¨˜æ†¶ã§ããªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿãªã‚“ã¨ï¼Œã§ãã¾ã™ï¼ãƒªã‚¹ãƒˆã®æœ«å°¾ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’æŒã¡ï¼Œ
ãã“ã«ç›´æ¥è¡Œã‘ã°ã„ã„ã®ã§ã™ï¼</p>
<p>ãƒªã‚¹ãƒˆã®æœ«å°¾ã‚’ä½¿ã†æ“ä½œã¯<code>push</code>ã¨<code>pop</code>ã®ã©ã¡ã‚‰ã‹ã§å¤§ä¸ˆå¤«ã§ã™ï¼<code>pop</code>ã§ä½¿ã†å ´åˆ
æœ«å°¾ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’é€†å‘ãã«ãŸã©ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒï¼Œç‰‡æ–¹å‘ãƒªã‚¹ãƒˆã®æ€§è³ªä¸Šã“ã‚Œã‚’
åŠ¹ç‡çš„ã«è¡Œã†ã®ã¯å›°é›£ã§ã™ï¼<code>push</code>ã§ä½¿ã†ã‚ˆã†ã«ã™ã‚Œã°ï¼Œpopã™ã‚‹ã¨ãã¯ãƒªã‚¹ãƒˆã®å…ˆé ­ã®
ãƒã‚¤ãƒ³ã‚¿ã‚’é †æ–¹å‘ã«ãŸã©ã‚Œã°ã„ã„ã®ã§æ¥½ã§ã™ã­ï¼</p>
<p>è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š</p>
<pre><code class="language-rust ignore">use std::mem;

pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
    tail: Link&lt;T&gt;, // NEW!
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;T&gt; List&lt;T&gt; {
    pub fn new() -&gt; Self {
        List { head: None, tail: None }
    }

    pub fn push(&amp;mut self, elem: T) {
        let new_tail = Box::new(Node {
            elem: elem,
            // pushã—ãŸã¨ãã®nextã¯å¸¸ã«None
            next: None,
        });

        // å¤ã„tailã‚’æ–°ã—ã„tailã«æ›´æ–°
        let old_tail = mem::replace(&amp;mut self.tail, Some(new_tail));

        match old_tail {
            Some(mut old_tail) =&gt; {
                // ã‚‚ã—tailãŒã™ã§ã«ã‚ã‚Œã°æ–°ã—ã„tailã‚’å…¥ã‚Œã‚‹
                old_tail.next = Some(new_tail);
            }
            None =&gt; {
                // ãã†ã§ãªã‘ã‚Œã°headã«å…¥ã‚Œã‚‹
                self.head = Some(new_tail);
            }
        }
    }
}
</code></pre>
<p>ã“ã®æ‰‹ã®æ“ä½œã‚’æ›¸ãã®ã¯ã‹ãªã‚Šæ…£ã‚Œã¦ãã¦ã„ã‚‹ã¨æ€ã†ã®ã§å®Ÿè£…ã®ãƒšãƒ¼ã‚¹ã‚’ã™ã“ã—ä¸Šã’ã¦ã„ãã¾ã™ï¼
ã¨ã¯ã„ãˆä¸Šã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ä¸€ç™ºã§æ›¸ãä¸Šã’ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ä»Šã¾ã§ã‚ã£ãŸã‚ˆã†ãª
ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’ã¨ã°ã—ã¦æ›¸ã„ã¦ã„ã‚‹ã ã‘ã§ã™ï¼å®Ÿéš›ç§ã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã«ã‚ãŸã£ã¦
ã‚ã¡ã‚ƒãã¡ã‚ƒé–“é•ãˆã¦ã¾ã™ï¼ç§ãŒå‡ºã—ãŸã‚¨ãƒ©ãƒ¼ã‚’å…¨éƒ¨è¦‹ã›ã¦ã„ãŸã‚‰<code>mut</code>ã‚„<code>;</code>ã®æ›¸ãå¿˜ã‚ŒãŒ
ã‚ã¾ã‚Šã«ã‚‚å¤šãæ•™æœ¬ã®ä½“ã‚’ãªã—ã¦ã„ãªã„ã§ã—ã‚‡ã†ï¼ã§ã‚‚å¿ƒé…ã—ãªã„ã§ãã ã•ã„ï¼ã“ã‚Œã‹ã‚‰
<em>åˆ¥ã®</em>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ²¢å±±è¦‹ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ï¼</p>
<pre><code class="language-text">&gt; cargo build

error[E0382]: use of moved value: `new_tail`
  --&gt; src/fifth.rs:38:38
   |
26 |         let new_tail = Box::new(Node {
   |             -------- move occurs because `new_tail` has type `std::boxed::Box&lt;fifth::Node&lt;T&gt;&gt;`, which does not implement the `Copy` trait
...
33 |         let old_tail = mem::replace(&amp;mut self.tail, Some(new_tail));
   |                                                          -------- value moved here
...
38 |                 old_tail.next = Some(new_tail);
   |                                      ^^^^^^^^ value used here after move
</code></pre>
<p>ã‚¯ã‚½ï¼</p>
<blockquote>
<p>use of moved value: <code>new_tail</code></p>
</blockquote>
<p>Boxã¯Copyã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã®ã§2ç®‡æ‰€ã«å…¥ã‚Œã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼æ›´ã«é‡è¦ãªã“ã¨ã¯Boxã¯
ä¸­èº«ã®æ‰€æœ‰æ¨©ã‚’æŒã¤ã®ã§BoxãŒdropã•ã‚ŒãŸã¨ãä¸­èº«ã‚’è§£æ”¾ã—ã‚ˆã†ã¨ã™ã‚‹ç‚¹ã§ã™ï¼ã‚‚ã—ã“ã®
å®Ÿè£…ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã—ã¾ã£ãŸã‚‰<code>push</code>ã™ã‚‹ãŸã³ã«ãƒªã‚¹ãƒˆã®æœ«å°¾ã‚’2å›è§£æ”¾ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ï¼
ã¨ã„ã†ã‹å®Ÿéš›ç§é”ã®ã‚³ãƒ¼ãƒ‰ã¯pushã®ãŸã³ã«old_tailã‚’è§£æ”¾ã—ã¦ã„ã¾ã™ï¼ã‚®ã‚¨ãƒ¼ï¼ğŸ™€</p>
<p>OKï¼Œã§ã‚‚ç§é”ã¯æ‰€æœ‰æ¨©ã‚’æŒãŸãªã„ãƒã‚¤ãƒ³ã‚¿ãŒãªã«ã‹çŸ¥ã£ã¦ã„ã¾ã™ï¼ãµã¤ã†ã®å‚ç…§ã§ã™ï¼</p>
<pre><code class="language-rust ignore">pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
    tail: Option&lt;&amp;mut Node&lt;T&gt;&gt;, // NEW!
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;T&gt; List&lt;T&gt; {
    pub fn new() -&gt; Self {
        List { head: None, tail: None }
    }

    pub fn push(&amp;mut self, elem: T) {
        let new_tail = Box::new(Node {
            elem: elem,
            // pushã—ãŸã¨ãã®nextã¯å¸¸ã«None
            next: None,
        });

        // Put the box in the right place, and then grab a reference to its Node
        let new_tail = match self.tail.take() {
            Some(old_tail) =&gt; {
                // ã‚‚ã—tailãŒã™ã§ã«ã‚ã‚Œã°æ–°ã—ã„tailã‚’å…¥ã‚Œã‚‹
                old_tail.next = Some(new_tail);
                old_tail.next.as_mut().map(|node| &amp;mut **node)
            }
            None =&gt; {
                // ãã†ã§ãªã‘ã‚Œã°headã«å…¥ã‚Œã‚‹
                self.head = Some(new_tail);
                self.head.as_mut().map(|node| &amp;mut **node)
            }
        };

        self.tail = new_tail;
    }
}
</code></pre>
<p>ç‰¹ã«ãƒˆãƒªãƒƒã‚­ãƒ¼ãªã“ã¨ã¯ã—ã¦ã„ã¾ã›ã‚“ï¼åŸºæœ¬çš„ãªç™ºæƒ³ã¯ã•ã£ãã¨åŒã˜ã§ï¼Œé•ã„ã¯æš—é»™ã®ãƒªã‚¿ãƒ¼ãƒ³
ã‚’ä½¿ã£ã¦new_tailã‚’ä½œã£ã¦ã„ã‚‹ã“ã¨ãã‚‰ã„ã§ã™ï¼</p>
<pre><code class="language-text">&gt; cargo build

error[E0106]: missing lifetime specifier
 --&gt; src/fifth.rs:3:18
  |
3 |     tail: Option&lt;&amp;mut Node&lt;T&gt;&gt;, // NEW!
  |                  ^ expected lifetime parameter
</code></pre>
<p>ã‚ã‚ãã†ã§ã—ãŸï¼ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã‚’ä¸ãˆãªãã¦ã¯ã„ã‘ã¾ã›ã‚“ï¼ã†ãƒ¼ã‚“...ã“ã“ã®ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã¯
ä½•ã§ã—ã‚‡ã†ï¼Ÿãˆã£ã¨ï¼Œã“ã‚Œã£ã¦IterMutã«ä¼¼ã¦ã¾ã™ã‚ˆã­ï¼ŸIterMutã¨åŒã˜ã“ã¨ã‚’ã—ã¦ï¼Œ
ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã¯<code>'a</code>ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ï¼š</p>
<pre><code class="language-rust ignore">pub struct List&lt;'a, T&gt; {
    head: Link&lt;T&gt;,
    tail: Option&lt;&amp;'a mut Node&lt;T&gt;&gt;, // NEW!
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;'a, T&gt; List&lt;'a, T&gt; {
    pub fn new() -&gt; Self {
        List { head: None, tail: None }
    }

    pub fn push(&amp;mut self, elem: T) {
        let new_tail = Box::new(Node {
            elem: elem,
            // pushã—ãŸã¨ãã®nextã¯å¸¸ã«None
            next: None,
        });

        // Put the box in the right place, and then grab a reference to its Node
        let new_tail = match self.tail.take() {
            Some(old_tail) =&gt; {
                // ã‚‚ã—tailãŒã™ã§ã«ã‚ã‚Œã°æ–°ã—ã„tailã‚’å…¥ã‚Œã‚‹
                old_tail.next = Some(new_tail);
                old_tail.next.as_mut().map(|node| &amp;mut **node)
            }
            None =&gt; {
                // ãã†ã§ãªã‘ã‚Œã°headã«å…¥ã‚Œã‚‹
                self.head = Some(new_tail);
                self.head.as_mut().map(|node| &amp;mut **node)
            }
        };

        self.tail = new_tail;
    }
}
</code></pre>
<pre><code class="language-text">cargo build

error[E0495]: cannot infer an appropriate lifetime for autoref due to conflicting requirements
  --&gt; src/fifth.rs:35:27
   |
35 |                 self.head.as_mut().map(|node| &amp;mut **node)
   |                           ^^^^^^
   |
note: first, the lifetime cannot outlive the anonymous lifetime #1 defined on the method body at 18:5...
  --&gt; src/fifth.rs:18:5
   |
18 | /     pub fn push(&amp;mut self, elem: T) {
19 | |         let new_tail = Box::new(Node {
20 | |             elem: elem,
21 | |             // pushã—ãŸã¨ãã®nextã¯å¸¸ã«None
...  |
39 | |         self.tail = new_tail;
40 | |     }
   | |_____^
note: ...so that reference does not outlive borrowed content
  --&gt; src/fifth.rs:35:17
   |
35 |                 self.head.as_mut().map(|node| &amp;mut **node)
   |                 ^^^^^^^^^
note: but, the lifetime must be valid for the lifetime 'a as defined on the impl at 13:6...
  --&gt; src/fifth.rs:13:6
   |
13 | impl&lt;'a, T&gt; List&lt;'a, T&gt; {
   |      ^^
   = note: ...so that the expression is assignable:
           expected std::option::Option&lt;&amp;'a mut fifth::Node&lt;T&gt;&gt;
              found std::option::Option&lt;&amp;mut fifth::Node&lt;T&gt;&gt;


</code></pre>
<p>ã‚ãƒ¼ï¼Œã“ã‚Œã¯ãšã„ã¶ã‚“è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã­ï¼ã“ã‚Œã¯ã™ã“ã—æ†‚æ…®ã™ã¹ãã‚¨ãƒ©ãƒ¼ã§ã™ï¼
ã¨ã„ã†ã®ã‚‚ã“ã‚Œã«ã‚ˆã‚‹ã¨ç§é”ã¯ã‹ãªã‚Šã‚ã¡ã‚ƒãã¡ã‚ƒãªã“ã¨ã‚’ã‚„ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ï¼èˆˆå‘³æ·±ã„ã®ã¯
éƒ¨åˆ†ã§ã™ï¼š</p>
<blockquote>
<p>the lifetime must be valid for the lifetime <code>'a</code> as defined on the impl</p>
</blockquote>
<p><code>self</code>ã‚’å€Ÿç”¨ã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ãŒï¼Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å°‘ãªãã¨ã‚‚<code>'a</code>ã ã‘ç”Ÿå­˜ã—ã¦æ¬²ã—ãŒã£ã¦ã„ã¾ã™ï¼
ã§ã¯<code>self</code>ãŒå®Ÿéš›<code>'a</code>ã ã‘ç”Ÿå­˜ã™ã‚‹ã¨ç¤ºã›ã°ã©ã†ã§ã—ã‚‡ã†...ï¼Ÿ</p>
<pre><code class="language-rust ignore">    pub fn push(&amp;'a mut self, elem: T) {
</code></pre>
<pre><code class="language-text">cargo build

warning: field is never used: `elem`
 --&gt; src/fifth.rs:9:5
  |
9 |     elem: T,
  |     ^^^^^^^
  |
  = note: #[warn(dead_code)] on by default
</code></pre>
<p>è¦‹ã¦ãã ã•ã„ï¼Œå‹•ãã¾ã—ãŸï¼ã‚„ã£ãŸï¼</p>
<p><code>pop</code>ã‚‚åŒæ§˜ã«å®Ÿè£…ã—ã¾ã™ï¼š</p>
<pre><code class="language-rust ignore">pub fn pop(&amp;'a mut self) -&gt; Option&lt;T&gt; {
    // ãƒªã‚¹ãƒˆã®ä»Šã®headã‚’å–ã‚‹
    self.head.take().map(|head| {
        let head = *head;
        self.head = head.next;

        // ã‚‚ã—`head`ãŒãªã‹ã£ãŸã‚‰tailã«`None`ã‚’å…¥ã‚Œã‚‹
        if self.head.is_none() {
            self.tail = None;
        }

        head.elem
    })
}
</code></pre>
<p>ãã—ã¦ã¡ã‚ƒã¡ã‚ƒã£ã¨ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ï¼š</p>
<pre><code class="language-rust ignore">mod test {
    use super::List;
    #[test]
    fn basics() {
        let mut list = List::new();

        // ç©ºã®ãƒªã‚¹ãƒˆãŒå‹•ãã“ã¨ã‚’ç¢ºèª
        assert_eq!(list.pop(), None);

        // ãƒªã‚¹ãƒˆã®è¦ç´ ã‚’ã¤ã‚ã‚‹
        list.push(1);
        list.push(2);
        list.push(3);

        // æ™®é€šã«è¦ç´ ã‚’å‰Šé™¤ã—ã¦ã¿ã‚‹
        assert_eq!(list.pop(), Some(1));
        assert_eq!(list.pop(), Some(2));

        // ä½•ã‚‚å£Šã‚Œã¦ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã‚‚ã†ä¸€å›push
        list.push(4);
        list.push(5);

        // æ™®é€šã«è¦ç´ ã‚’å‰Šé™¤ã—ã¦ã¿ã‚‹
        assert_eq!(list.pop(), Some(3));
        assert_eq!(list.pop(), Some(4));

        // ãƒªã‚¹ãƒˆã‚’å‡ºã—åˆ‡ã£ãŸã¨ã
        assert_eq!(list.pop(), Some(5));
        assert_eq!(list.pop(), None);
    }
}
</code></pre>
<pre><code class="language-text">cargo test

error[E0499]: cannot borrow `list` as mutable more than once at a time
  --&gt; src/fifth.rs:68:9
   |
65 |         assert_eq!(list.pop(), None);
   |                    ---- first mutable borrow occurs here
...
68 |         list.push(1);
   |         ^^^^
   |         |
   |         second mutable borrow occurs here
   |         first borrow later used here

error[E0499]: cannot borrow `list` as mutable more than once at a time
  --&gt; src/fifth.rs:69:9
   |
65 |         assert_eq!(list.pop(), None);
   |                    ---- first mutable borrow occurs here
...
69 |         list.push(2);
   |         ^^^^
   |         |
   |         second mutable borrow occurs here
   |         first borrow later used here

error[E0499]: cannot borrow `list` as mutable more than once at a time
  --&gt; src/fifth.rs:70:9
   |
65 |         assert_eq!(list.pop(), None);
   |                    ---- first mutable borrow occurs here
...
70 |         list.push(3);
   |         ^^^^
   |         |
   |         second mutable borrow occurs here
   |         first borrow later used here


....

** ã¾ã ã¾ã ã‚ã‚‹ã‚¨ãƒ©ãƒ¼ **

....

error: aborting due to 11 previous errors
</code></pre>
<p>ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€</p>
<p>ä½•ã¨ã„ã†ã“ã¨ã§ã—ã‚‡ã†ï¼</p>
<p>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯æ‚ªãã‚ã‚Šã¾ã›ã‚“ï¼ç§é”ã¯ãŸã£ãŸä»ŠRustã®åŸç½ª<sup class="footnote-reference"><a href="#1">1</a></sup>ã‚’çŠ¯ã—ãŸã®ã§ã™ï¼ç§é”ã¯
è‡ªåˆ†ã¸ã®å‚ç…§ã‚’<em>è‡ªåˆ†è‡ªèº«ã®ä¸­ã«</em>æŒã£ã¦ã—ã¾ã„ã¾ã—ãŸï¼<code>push</code>ã¨<code>pop</code>ã®å®Ÿè£…ã§ã¯
ãªã‚“ã¨ã‹Rustã‚’è¨€ã„ãã‚‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼ˆãã‚ŒãŒã§ããŸã®ã¯è¡æ’ƒçš„ã§ã—ãŸãŒï¼‰ï¼
ç§ã¯RustãŒ<code>push</code>ã¨<code>pop</code>ã‚’è¦‹ãŸæ™‚ç‚¹ã§ã¯å‚ç…§ãŒãã‚Œè‡ªèº«ã®ä¸­ã«ã‚ã‚‹ã‹ã©ã†ã‹
åˆ†ã‹ã‚‰ãªã‹ã£ãŸã‚“ã ã¨æ€ã„ã¾ã™ãŒ--ã¨ã„ã†ã‹ï¼ŒRustã«ã¯ãã†ã„ã†æ¦‚å¿µãŒã‚ã‚Šã¾ã›ã‚“ï¼
è‡ªåˆ†è‡ªèº«ã¸ã®å‚ç…§ãŒå‹•ä½œã—ãªã„ã®ã¯å˜ãªã‚‹ç¾è±¡ã«éããšï¼Œæ ¹æœ¬çš„ãªå•é¡Œã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼</p>
<p>ç§é”ã®ãƒªã‚¹ãƒˆã¯ä½¿ãŠã†ã¨ã—ãŸé€”ç«¯å…¨ã¦ãŒç©ºä¸­åˆ†è§£ã—ã¾ã™ï¼<code>push</code>ã‚„<code>pop</code>ã‚’å‘¼ã‚“ã ç¬é–“
ãƒªã‚¹ãƒˆã¯è‡ªåˆ†ã¸ã®å‚ç…§ã‚’æŒã¡ï¼Œ<em>è©°ã¿ã¾ã™</em>ï¼è‡ªåˆ†è‡ªèº«ã‚’å€Ÿç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ï¼</p>
<p><code>pop</code>ã®å®Ÿè£…ã‚’è¦‹ã‚‹ã¨ãªãœã“ã‚ŒãŒå±é™ºã§ã‚ã‚‹ã‹ã‚ã‹ã‚Šã¾ã™ï¼š</p>
<pre><code class="language-rust ignore">// ...
if self.head.is_none() {
    self.tail = None;
}
</code></pre>
<p>ã‚‚ã—ç§é”ãŒã“ã‚Œã‚’å¿˜ã‚ŒãŸã‚‰ã©ã†ãªã£ã¦ã„ãŸã§ã—ã‚‡ã†ï¼Ÿãƒªã‚¹ãƒˆã®tailã¯<em>ãƒªã‚¹ãƒˆã‹ã‚‰é™¤å¤–ã•ã‚ŒãŸ
ãƒãƒ¼ãƒ‰</em>ã‚’æŒ‡ã™ã“ã¨ã«ãªã‚Šã¾ã™ï¼ãƒªã‚¹ãƒˆã‹ã‚‰é™¤å¤–ã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã®ãƒ¡ãƒ¢ãƒªã¯è§£æ”¾ã•ã‚Œï¼ŒRust
ãŒé˜²ã„ã§ãã‚Œã‚‹ã¯ãšã®ãƒ€ãƒ³ã‚°ãƒªãƒ³ã‚°ãƒã‚¤ãƒ³ã‚¿ãŒç”Ÿã¾ã‚Œã¦ã—ã¾ã„ã¾ã™ï¼</p>
<p>Rustã¯ãŸã—ã‹ã«ãã†ã„ã†å±é™ºã‹ã‚‰ç§é”ã‚’å®ˆã£ã¦ãã‚Œã¦ã„ã‚‹ã®ã§ã™ï¼ãŸã ã‹ãªã‚Š...
<strong>å›ã‚Šãã©ã„</strong>ã‚„ã‚Šã‹ãŸã§ã™ãŒï¼</p>
<p>ã§ã¯ã©ã†ã—ãŸã‚‰ã„ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿã¾ãŸ<code>Rc&lt;RefCell&gt;&gt;</code>åœ°ç„ã«æˆ»ã‚‹ï¼Ÿ</p>
<p>ã ã‚ã§ã™ï¼å‹˜å¼ã—ã¦ãã ã•ã„ï¼</p>
<p>ã‹ã‚ã‚Šã«æ•·ã‹ã‚ŒãŸãƒ¬ãƒ¼ãƒ«ã‚’å¤–ã‚Œã¦<em>ç”Ÿã®ãƒã‚¤ãƒ³ã‚¿</em>ã‚’ä½¿ã„ã¾ã™ï¼ç§é”ã®ãƒªã‚¹ãƒˆã¯ã“ã‚“ãªæ„Ÿã˜ã«
ãªã‚‹ã§ã—ã‚‡ã†ï¼š</p>
<pre><code class="language-rust ignore">pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
    tail: *mut Node&lt;T&gt;, // DANGER DANGER
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}
</code></pre>
<p>ãã—ã¦ã“ã‚ŒãŒå…¨ã¦ã§ã™ï¼ã‚‚ã†ã‚¯ã‚½é›‘é­šå‚ç…§ã‚«ã‚¦ãƒ³ãƒˆä»˜å‹•çš„å€Ÿç”¨ãƒã‚§ãƒƒã‚¯ã«ã¯é ¼ã‚Šã¾ã›ã‚“ï¼
æœ¬ç‰©ã®ï¼Œéé…·ãªï¼Œæœªæ¤œæŸ»ã®ï¼Œãƒã‚¤ãƒ³ã‚¿ã‚’ä½¿ã„ã¾ã™ï¼</p>
<p>ã¿ãªã•ã‚“ï¼ŒCè¨€èªã§ã„ãã¾ã—ã‚‡ã†ï¼ã„ã¤ã‚‚ï¼Œã„ã¤ã§ã‚‚Cã§ï¼</p>
<p>ç§ã¯ã“ã“ã«å¸°ã£ã¦ãã¾ã—ãŸï¼ã‚‚ã†æº–å‚™ã¯ã§ãã¦ã¾ã™ï¼</p>
<p>Hello, <code>unsafe</code>.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>è¨³æ³¨ï¼šLustï¼ˆè‰²æ¬²ï¼‰ã¨ã‹ã‹ã£ã¦ã„ã‚‹</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="fifth.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="fifth-unsafe.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="fifth.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="fifth-unsafe.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
